&НаКлиенте
Процедура ЗаполнитьСубконто(Команда)
	ВыполнитьЗаполнение();
КонецПроцедуры

&НаСервереБезКонтекста
Процедура ВыполнитьЗаполнение()
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ПроводкиОборотыДтКт.Регистратор
	|ИЗ
	|	РегистрБухгалтерии.Проводки.ОборотыДтКт(, , 
	|		Регистратор, 
	|		СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Бухгалтерский.Капитал), , 
	|		СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Бухгалтерский.Товары), , ) КАК ПроводкиОборотыДтКт";
	Результат = Запрос.Выполнить();
	РегистрыБухгалтерии.Проводки.УстановитьИспользованиеИтогов(Ложь);
	Выборка = Результат.Выбрать();
	ТекНоменклатура = Неопределено;
	Пока Выборка.Следующий() Цикл
		//ДокументСсылка = Выборка.Регистратор;
		Проводки = РегистрыБухгалтерии.Проводки.СоздатьНаборЗаписей();
		Проводки.Отбор.Регистратор.Установить(Выборка.Регистратор);
		Проводки.Прочитать();
		Для каждого Проводка Из Проводки Цикл
			Если Проводка.СчетДт = ПланыСчетов.Бухгалтерский.Капитал 
			И Проводка.СчетКт = ПланыСчетов.Бухгалтерский.Товары Тогда
				ТекНоменклатура = Проводка.СубконтоКт.Номенклатура;
				Проводка.СубконтоДт.Номенклатура = ТекНоменклатура;
			КонецЕсли;
			
			Если Проводка.СчетДт = ПланыСчетов.Бухгалтерский.Покупатели 
				И Проводка.СчетКт = ПланыСчетов.Бухгалтерский.Капитал
				И Проводка.Содержание = "Реализация товара" Тогда
				Проводка.СубконтоКт.Номенклатура = ТекНоменклатура;
			КонецЕсли;
		КонецЦикла; 
		
		Если Проводки.Модифицированность() Тогда
			Проводки.Записать();
		КонецЕсли;		
	КонецЦикла;

	РегистрыБухгалтерии.Проводки.УстановитьИспользованиеИтогов(Истина);
    
КонецПроцедуры
